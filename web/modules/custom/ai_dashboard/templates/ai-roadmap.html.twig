{#
/**
 * @file
 * Template for the AI Deliverables Roadmap.
 *
 * Available variables:
 * - columns: Array of deliverables grouped by status (complete, now, next, later)
 * - summary: Summary counts for each status
 * - filter_options: Array with 'tracks' and 'workstreams' arrays for filter dropdowns
 * - selected_track: Currently selected track filter value
 * - selected_workstream: Currently selected workstream filter value
 * - user_has_admin: Whether the current user has admin permissions
 *
 * Cards display only:
 * - Short Title (or fallback to regular title)
 * - Short Description
 * - Links: drupal.org issue link, edit link (admin only)
 */
#}

<div class="ai-roadmap">
  <!-- Top Navigation -->
  <div class="dashboard-navigation">
    <div class="nav-links">
      <a href="/ai-dashboard" class="nav-link">Dashboard</a>
      <a href="/ai-dashboard/calendar" class="nav-link">Calendar View</a>
      <a href="/ai-dashboard/calendar/organizational" class="nav-link">Organizational View</a>
      <a href="/ai-dashboard/roadmap" class="nav-link active">Roadmap</a>
      <a href="/ai-dashboard/priority-kanban" class="nav-link">Kanban</a>
      <a href="/ai-dashboard/projects" class="nav-link">Projects</a>
      <a href="/ai-dashboard/docs" class="nav-link">Docs</a>
    </div>
  </div>

  <!-- Header -->
  <div class="roadmap-header">
    <div class="roadmap-header-content">
      <div class="roadmap-header-left">
        <h1 class="page-title">AI Deliverables Roadmap</h1>
      </div>
      <div class="roadmap-header-right">
        {% if user_has_admin %}
          <button id="save-roadmap-order" class="button button--primary" style="display: none;">Save Order</button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="roadmap-filters">
    <form method="get" action="/ai-dashboard/roadmap" class="roadmap-filter-form" id="roadmap-filter-form">
      {% if filter_options.tracks|length > 0 %}
        <div class="filter-group">
          <label for="roadmap-track-filter">Track:</label>
          <select id="roadmap-track-filter" name="track" class="filter-select">
            <option value="">All Tracks</option>
            {% for track in filter_options.tracks %}
              <option value="{{ track }}" {{ track == selected_track ? 'selected="selected"' : '' }}>{{ track }}</option>
            {% endfor %}
          </select>
        </div>
      {% endif %}

      {% if filter_options.workstreams|length > 0 %}
        <div class="filter-group">
          <label for="roadmap-workstream-filter">Workstream:</label>
          <select id="roadmap-workstream-filter" name="workstream" class="filter-select">
            <option value="">All Workstreams</option>
            {% for workstream in filter_options.workstreams %}
              <option value="{{ workstream }}" {{ workstream == selected_workstream ? 'selected="selected"' : '' }}>{{ workstream }}</option>
            {% endfor %}
          </select>
        </div>
      {% endif %}

      {% if selected_track or selected_workstream %}
        <a href="/ai-dashboard/roadmap" class="clear-filters-link">Clear Filters</a>
      {% endif %}
    </form>
  </div>

  <!-- Roadmap Columns -->
  <div class="roadmap-columns">
    <!-- Complete Column -->
    <div class="roadmap-column complete" data-status="complete">
      <div class="column-header">
        <h2 class="column-title" title="Issues with status: Fixed, Closed (Fixed), Closed (Duplicate), or Closed (Works as designed)">Complete <span class="info-icon">ⓘ</span></h2>
        <span class="count">{{ summary.complete }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.complete %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Now Column -->
    <div class="roadmap-column now" data-status="now">
      <div class="column-header">
        <h2 class="column-title" title="Issues with an assignee AND linked to a project (priority work)">Now <span class="info-icon">ⓘ</span></h2>
        <span class="count">{{ summary.now }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.now %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Next Column -->
    <div class="roadmap-column next" data-status="next">
      <div class="column-header">
        <h2 class="column-title" title="Issues with an assignee but NOT linked to a project (being worked on but not priority)">Next <span class="info-icon">ⓘ</span></h2>
        <span class="count">{{ summary.next }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.next %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Later Column -->
    <div class="roadmap-column later" data-status="later">
      <div class="column-header">
        <h2 class="column-title" title="Issues with no assignee (not yet being worked on)">Later <span class="info-icon">ⓘ</span></h2>
        <span class="count">{{ summary.later }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.later %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
