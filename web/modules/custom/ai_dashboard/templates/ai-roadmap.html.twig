{#
/**
 * @file
 * Template for the AI Deliverables Roadmap.
 *
 * Available variables:
 * - columns: Array of deliverables grouped by status (complete, now, next, later)
 * - summary: Summary counts for each status
 * - user_has_admin: Whether the current user has admin permissions
 *
 * Cards display only:
 * - Short Title (or fallback to regular title)
 * - Short Description
 * - Links: drupal.org issue link, edit link (admin only)
 */
#}

<div class="ai-roadmap">
  <!-- Top Navigation -->
  <div class="dashboard-navigation">
    <div class="nav-links">
      <a href="/ai-dashboard" class="nav-link">Dashboard</a>
      <a href="/ai-dashboard/calendar" class="nav-link">Calendar View</a>
      <a href="/ai-dashboard/calendar/organizational" class="nav-link">Organizational View</a>
      <a href="/ai-dashboard/roadmap" class="nav-link active">Roadmap</a>
      <a href="/ai-dashboard/priority-kanban" class="nav-link">Kanban</a>
      <a href="/ai-dashboard/projects" class="nav-link">Projects</a>
      <a href="/ai-dashboard/docs" class="nav-link">Docs</a>
    </div>
  </div>

  <!-- Header -->
  <div class="roadmap-header">
    <div class="roadmap-header-content">
      <div class="roadmap-header-left">
        <h1 class="page-title">AI Deliverables Roadmap</h1>
      </div>
      <div class="roadmap-header-right">
        {% if user_has_admin %}
          <button id="save-roadmap-order" class="button button--primary" style="display: none;">Save Order</button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Roadmap Columns -->
  <div class="roadmap-columns">
    <!-- Complete Column -->
    <div class="roadmap-column complete" data-status="complete">
      <div class="column-header">
        <h2>Complete</h2>
        <span class="count">{{ summary.complete }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.complete %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Now Column -->
    <div class="roadmap-column now" data-status="now">
      <div class="column-header">
        <h2>Now</h2>
        <span class="count">{{ summary.now }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.now %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Next Column -->
    <div class="roadmap-column next" data-status="next">
      <div class="column-header">
        <h2>Next</h2>
        <span class="count">{{ summary.next }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.next %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Later Column -->
    <div class="roadmap-column later" data-status="later">
      <div class="column-header">
        <h2>Later</h2>
        <span class="count">{{ summary.later }}</span>
      </div>
      <div class="column-content">
        {% for item in columns.later %}
          <div class="deliverable-card"
               data-nid="{{ item.issue.id }}"
               data-issue-url="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}">
            <div class="card-header">
              <h3 class="card-title">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener">
                  {{ item.issue.field_short_title.value ?: item.issue.label }}
                </a>
              </h3>
              <div class="card-actions">
                <a href="https://www.drupal.org/node/{{ item.issue.field_issue_number.value }}"
                   target="_blank" rel="noopener" class="issue-link"
                   title="View on drupal.org">
                  <span class="external-icon">↗</span>
                </a>
                {% if user_has_admin %}
                  <a href="/node/{{ item.issue.id }}/edit" class="issue-edit-link"
                     title="Edit deliverable">
                    <span class="edit-icon">⚙</span>
                  </a>
                {% endif %}
              </div>
            </div>
            {% if item.issue.field_short_description.value %}
              <p class="card-description">
                {{ item.issue.field_short_description.value }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
